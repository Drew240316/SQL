★ 패턴 ）날짜 패턴 추출하기


1) group by + join + like
select b.author_id, b.author_name, a.category, sum(c.sales * a.price) as total_sales
from book a join author b on a.author_id = b.author_id
join book_sales c on c.book_id = a.book_id
where c.sales_date like '2022-01%'
group by b.author_id, b.author_name, a.category
order by b.author_id asc, a.category desc
;

2) group by + year + month 
select b.author_id, b.author_name, a.category, sum(c.sales * a.price) as total_sales
from book a join author b on a.author_id = b.author_id
join book_sales c on c.book_id = a.book_id
where year(c.sales_date) = '2022'
and month(c.sales_date) = '01'
group by b.author_id, b.author_name, a.category
order by b.author_id asc, a.category desc
;


3) group by + between 
select b.author_id, b.author_name, a.category, sum(c.sales * a.price) as total_sales
from book a join author b on a.author_id = b.author_id
join book_sales c on c.book_id = a.book_id
where c.sales_date between '2022-01-01' and '2022-01-31'
group by b.author_id, b.author_name, a.category
order by b.author_id asc, a.category desc
;


4) gruop by + date_format
select b.author_id, b.author_name, a.category, sum(c.sales * a.price) as total_sales
from book a join author b on a.author_id = b.author_id
join book_sales c on c.book_id = a.book_id
where date_format(c.sales_date, '%Y-%m') = '2022-01'
group by b.author_id, b.author_name, a.category
order by b.author_id asc, a.category desc
;
--------------------------------------------------------------------<오답>--------------------------------------------------------------------------------------------------

★ 오답 ) 
select b.author_id, b.author_name, a.category, sum(c.sales * a.price) as total_sales
from book a join author b on a.author_id = b.author_id
join book_sales c on c.book_id = a.book_id
group by a.category
where c.sales_date like '2022%-01%' ▲
order by b.author_id desc, a.category desc
;

SQL 실행 중 오류가 발생하였습니다.
You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'where c.sales_date like '2022%-01%'
order by b.author_id desc, a.category desc' at line 5

이유 ? where절을 group by보다 앞에

★ 오답 ) 
select b.author_id, b.author_name, a.category, sum(c.sales * a.price) as total_sales
from book a join author b on a.author_id = b.author_id
join book_sales c on c.book_id = a.book_id
where c.sales_date like '2022%-01%'
group by a.category
order by b.author_id desc, a.category desc
;

이유? WHERE에서 연도·월 비교를 정확히 하고 싶으면?
like '2022-01%'

★ 오답 ) 
select b.author_id, b.author_name, a.category, sum(c.sales * a.price) as total_sales
from book a join author b on a.author_id = b.author_id
join book_sales c on c.book_id = a.book_id
where c.sales_date like '2022-01%'
group by a.category
order by b.author_id desc, a.category desc
;

이유? 그룹 기준 컬럼, 그룹기준 컬럼, 그룹기준 컬럼, 집계함수 컬럼을 꼭 쓰자

-> 정답  1 


-----
★ 오답 ) 
select b.author_id, b.author_name, a.category, sum(c.sales * a.price) as total_sales
from book a join author b on a.author_id = b.author_id
join book_sales c on c.book_id = a.book_id
where year(c.sales_date) = '2022-01'
group by b.author_id, b.author_name, a.category
order by b.author_id asc, a.category desc
;

이유 ? year과 month함수의 혼합 사 -> 정답 2


★ 오답 ) 
select b.author_id, b.author_name, a.category, sum(c.sales * a.price) as total_sales
from book a join author b on a.author_id = b.author_id
join book_sales c on c.book_id = a.book_id
where date_format(c.sales_date, 'Y%-m%') = '2022-01'
group by b.author_id, b.author_name, a.category
order by b.author_id asc, a.category desc
;


이유 ? date_format함수는 %를 쓸 때 날짜 앞에 쓴다. -> 정답 4






